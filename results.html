<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WAF-FLED! Tournaments</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <style>
    .tournament-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .tournament-card {
      background: #1f2430;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .tournament-card a {
      color: #ffd54a;
      text-decoration: none;
      font-weight: 500;
    }

    .tournament-card a:hover {
      text-decoration: underline;
    }

    .tournament-meta {
      opacity: 0.8;
      margin-top: 0.3rem;
      font-size: 0.9rem;
    }

    .loading {
      opacity: 0.8;
      font-style: italic;
      margin-top: 0.5rem;
    }

    h2.section-title {
      margin-top: 2rem;
    }
  </style>
</head>

<body>
<header>
  <h1>üßá WAF-FLED!</h1>
  <nav>
    <a href="index.html">Leaderboard</a>
    <a href="results.html">Tournaments</a>
    <a href="achievements.html">Achievements</a>
  </nav>
</header>

<main>
  <h2 class="section-title">üìú Tournament History</h2>
  <div id="past" class="tournament-list">
    <p class="loading">Loading tournaments...</p>
  </div>

  <h2 class="section-title">‚è≥ Upcoming Tournaments</h2>
  <div id="future" class="tournament-list">
    <p class="loading">Loading tournaments...</p>
  </div>
</main>

<script>
/* ===== ONLY EDIT THIS LIST ===== */
const TOURNAMENTS = [
  { id: "ZLfbxNcu", name: "Weekly WAF-FLED #1 Arena" },
  { id: "Z2DuzTxs", name: "Weekly WAF-FLED #2 Arena" }
];

/* ===== FETCH TOURNAMENT INFO ===== */
async function fetchTournament(id) {
  try {
    const r = await fetch(`https://lichess.org/api/tournament/${id}`);
    return await r.json();
  } catch {
    return null;
  }
}

async function buildTournaments() {
  const pastEl = document.getElementById("past");
  const futureEl = document.getElementById("future");

  pastEl.innerHTML = "";
  futureEl.innerHTML = "";

  const now = Date.now();

  const data = await Promise.all(
    TOURNAMENTS.map(async t => {
      const info = await fetchTournament(t.id);
      if (!info) return null;
      return {
        ...t,
        startsAt: info.startsAt,
        finished: info.isFinished
      };
    })
  );

  const valid = data.filter(Boolean);

  const past = valid
    .filter(t => t.finished || t.startsAt < now)
    .sort((a,b) => b.startsAt - a.startsAt);

  const future = valid
    .filter(t => !t.finished && t.startsAt >= now)
    .sort((a,b) => a.startsAt - b.startsAt);

  if (!past.length) {
    pastEl.innerHTML = "<p class='loading'>No past tournaments yet</p>";
  } else {
    past.forEach(t => pastEl.appendChild(renderCard(t)));
  }

  if (!future.length) {
    futureEl.innerHTML = "<p class='loading'>No upcoming tournaments</p>";
  } else {
    future.forEach(t => futureEl.appendChild(renderCard(t)));
  }
}

function renderCard(t) {
  const div = document.createElement("div");
  div.className = "tournament-card";

  const date = new Date(t.startsAt).toLocaleString();

  div.innerHTML = `
    <a href="https://lichess.org/tournament/${t.id}" target="_blank">
      ${t.name}
    </a>
    <div class="tournament-meta">
      Starts: ${date}
    </div>
  `;

  return div;
}

buildTournaments();
</script>
</body>
</html>
