<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WAF-FLED! Tournaments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>ğŸ§‡ WAF-FLED!</h1>
  <nav>
    <a href="index.html">Leaderboard</a>
    <a href="results.html">Tournaments</a>
    <a href="achievements.html">Achievements</a>
  </nav>
</header>

<main>
  <div class="update-section">
    <button class="update-btn" id="updateBtn">ğŸ”„ Check for new tournaments</button>
    <small id="updateNote">âš ï¸ Press only when needed. Frequent clicks may take a few seconds.</small>
  </div>
  <small id="lastUpdated">Last updated on: --</small>

  <h2>ğŸ“… Tournament History</h2>
  <div id="pastTournaments"></div>

  <h2>â³ Upcoming Tournaments</h2>
  <div id="futureTournaments"></div>
</main>

<script>
const TOURNAMENTS = [
  {id:"ZLfbxNcu",name:"Weekly WAF-FLED #1 Arena"},
  {id:"Z2DuzTxs",name:"Weekly WAF-FLED 2 Arena"}
];

let cachedData = JSON.parse(localStorage.getItem("wafData")) || { lastUpdated:null };

function renderTournaments(){
  const now = new Date();
  const past = document.getElementById("pastTournaments");
  const future = document.getElementById("futureTournaments");
  past.innerHTML="";
  future.innerHTML="";

  TOURNAMENTS.forEach(t=>{
    const box = document.createElement("a");
    box.href=`https://lichess.org/tournament/${t.id}`;
    box.target="_blank";
    box.className="tournament-box";
    box.innerText=t.name;

    // Check if tmt is already over
    const endDate = new Date();
    endDate.setDate(endDate.getDate() - (endDate.getDay()===0?0: endDate.getDay())); // assume tournaments happen on Sunday
    if(now>endDate){
      past.appendChild(box);
    } else {
      future.appendChild(box);
    }
  });

  const lastUpdated = cachedData.lastUpdated ? new Date(cachedData.lastUpdated).toLocaleString():"--";
  document.getElementById("lastUpdated").innerText=`Last updated on: ${lastUpdated}`;
}

async function updateData(){
  document.getElementById("updateBtn").disabled=true;
  document.getElementById("updateBtn").innerText="Loading...";

  // In case you want to fetch latest tournaments from team API, could implement here
  cachedData.lastUpdated=Date.now();
  localStorage.setItem("wafData",JSON.stringify(cachedData));

  renderTournaments();
  document.getElementById("updateBtn").disabled=false;
  document.getElementById("updateBtn").innerText="ğŸ”„ Check for new tournaments";
}

document.getElementById("updateBtn").addEventListener("click",updateData);
renderTournaments();
</script>
</body>
</html>
